{% extends "layouts/default.html" %}

{% block content %}
<div class="container-fluid mt-3">
	<div class="row">
		<div class="col-md-8">
			{{ pageTitle }}
			<canvas id="myChart" class="mb-3"></canvas>
		</div>
		<div class="col-md-4">
			<h3>Tracking Stocks</h3>
			{% for stock in stocks %}
			<div class="mb-1">
				<i class="fa fa-times fa-fw ml-1 text-danger remove-stock" data-id="{{ stock._id }}"></i>
				{{ stock.stockName }}
			</div>
			{% endfor %}
			<hr>
			<h3>Add a Stock</h3>
			<form id="stockForm" action="/" method="post">
				<div class="form-group">
					<input id="stock" type="text" name="stock" value="" class="form-control">
				</div>
				<div class="form-group">
					<input type="submit" name="button" value="Add a Stock" class="btn btn-primary form-control">
				</div>
			</form>
		</div>
	</div>
</div>
{% endblock %}

{% block extra_js %}
{# Stock Form #}
<script type="text/javascript">
$(".remove-stock").on("click", function() {
	var stockId = $(this).data('id');

    $.ajax({
        method: "DELETE",
        url: "/" + stockId,
		data: {},
        dataType: 'json',
        success: function() {
			location.reload();
        },
        error: function(error) {
            alert('error');
        }
    });
});

$(function(){
	var $stockForm = $('#stockForm');
	var $stock = $('#stock');

	var socket = io.connect();

});
</script>

<script type="text/javascript">
/* -- Chart -- */
var data = {{ stocks | dump | safe }};

var datasets = [];
data.forEach(function(stock, index){
	datasets.push({
        label: stock.stockName,
		fill: false,
        data: stock.data.map(element => element.value)
    })
});

var ctx = document.getElementById('myChart').getContext('2d');
var data = {
    labels: data[0].data.map(element => element.date),
    datasets: datasets
};

var myLineChart = new Chart(ctx, {
    type: 'line',
    data: data
});
</script>
{% endblock %}
